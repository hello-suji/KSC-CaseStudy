# 📘 복합 목표 기반 LLM 자동 테스트 생성 실험 보고서

본 문서는 LLM 기반 자동 테스트 생성 실험의 목적, 사용된 프롬프트 예시, 그리고 복합 목표 적용 여부에 따른 커버리지 비교 결과를 정리한 것이다.

---

## 1. 실험 소개

### 1.1 실험 목적

본 실험은 **대형 언어 모델(LLM)** 을 이용해 테스트 코드를 자동 생성할 때,
특히 **복합 테스트 목표(Composite Testing Goals)** 를 제공하면 테스트 커버리지가 얼마나 향상되는지를 검증하는 데 목적이 있다.

복합 목표는 다음 세 가지 소스코드 구조적 요소를 통합하여 생성된다.

* **분기 흐름(Branch Flow)**
* **정의–사용 체인(Def–Use Chain)**
* **예외 흐름(Exception Path)**

이러한 목표 기반 지시를 통해 LLM이 단순 코드 해석을 넘어 **정확한 경로 타격 테스트**를 생성할 수 있도록 유도한다.

---

### 1.2 실험 개요

실험은 다음 절차로 수행되었다.

1. **기준선 커버리지 측정**

   * 실행 가능 라인 및 브랜치 수 계산
   * 기존 pytest 테스트 실행 및 기본 커버리지 확보

2. **복합 목표 생성**

   * AST 기반 미커버 라인/브랜치/정의–사용/예외 조건 분석
   * Gain-On-Cost 기반 목표 랭킹 후 상위 목표 선정

3. **LLM 테스트 생성 (Initial)**

   * 목표 기반 초기 프롬프트 생성
   * 입력 제약 / 경로 조건 / def-use 흐름 포함

4. **오류 수정·커버리지 강화 프롬프트 반복 적용**

   * 실패 테스트 수정(Repair)
   * 커버리지 미충족 목표를 위한 증강(Augmentation)

5. **최종 테스트 스위트 실행 및 커버리지 비교**

---

## 2. 사용된 프롬프트 예시

아래 예시는 실제 실험에서 사용된 프롬프트 구조를 기반으로 재구성한 것이다.

---

### 2.1 3.4 단계 — 초기 테스트 생성 프롬프트 예시

```
SYSTEM:
당신은 주어진 실행 목표를 충족하는 pytest 테스트를 생성하는 엔진입니다.
아래 JSON 형식으로만 출력하세요:

{
  "filename": "test_*.py",
  "tests": [
    {"name": "test_*", "code": "<pytest code>"}
  ]
}

규칙:
- importlib.import_module + getattr만 사용
- markdown, 주석 금지
- 외부 의존성 없이 실행 가능해야 함

USER:
Goal ID: 0003
타겟 파일: money_transfer/worker.py
타겟 라인: [52, 55]

구성 요소:
  branch: line 52
  def-use: amount (38 → 55)
입력 제약:
  - amount > 0
  - value-flow: amount defined@38 → used@55

해당 라인을 모두 도달하는 pytest 테스트를 작성하세요.
```

---

### 2.2 3.6 단계 — 오류 수정 및 커버리지 향상 프롬프트 예시

```
SYSTEM:
이전 테스트가 실패했거나 커버리지를 개선하지 못했습니다.
오직 실패한 테스트만 수정하여 JSON으로 다시 출력하세요.

USER:
오류 내용:
ValueError: insufficient funds

아직 커버되지 않은 타겟 라인: [90]

입력 혹은 mock 설정을 수정해 해당 라인을 도달하도록 고치십시오.
```

---

## 3. 실험 결과

아래 결과는 동일한 코드베이스에서
① pytest 기준,
② 복합 목표 없이 생성된 테스트,
③ 복합 목표 기반 테스트
간의 커버리지를 비교한 것이다.

복합 목표 기반 테스트가 **가장 높은 라인/브랜치 커버리지 증가**를 보였다.

---

### 📊 표 1. 커버리지 비교 결과

#### **복합 목표 정보 있음**

| 평가 항목         | pytest | 본 연구  |
| ------------- | ------ | ----- |
| 실행된 테스트 개수(개) | 3      | 6     |
| 라인 커버리지(%)    | 43.4   | 68.09 |
| 분기 커버리지(%)    | 44.44  | 80.56 |

---

#### **복합 목표 정보 없음**

| 평가 항목         | pytest | 본 연구  |
| ------------- | ------ | ----- |
| 실행된 테스트 개수(개) | 3      | 3     |
| 라인 커버리지(%)    | 43.4   | 59.15 |
| 분기 커버리지(%)    | 44.44  | 75.0  |

---

## 4. 결론

* **복합 목표 기반 LLM 테스트 생성**은
  기존 pytest 대비뿐 아니라 **LLM 단독 생성보다 훨씬 높은 커버리지**를 달성하였다.

* 특히 분기 커버리지 향상 폭이 크며(44% → 80%),
  이는 복합 목표가 코드 경로 탐색에 효과적으로 작용함을 의미한다.

* 복합 목표 없이도 일부 커버리지 향상은 있었으나,
  **테스트 개수 증가가 없고 도달 경로 탐색도 제한적**이었다.
