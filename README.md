# KSC Case Study â€“ Composite Testing Goals for LLM-based Test Generation

ë³¸ ë¦¬í¬ì§€í† ë¦¬ëŠ” **ë³µí•© ëª©í‘œ ê¸°ë°˜ LLM ìë™ í…ŒìŠ¤íŠ¸ ìƒì„± ì—°êµ¬**ì˜ ì‚¬ë¡€ ì‹¤í—˜ ê²°ê³¼ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.  
ëŒ€ìƒ í”„ë¡œì íŠ¸ëŠ” Temporal ê³µì‹ ì˜ˆì œì¸ [`money-transfer-project-template-python`](https://github.com/temporalio/money-transfer-project-template-python)ì´ë©°,  
ë³¸ ì—°êµ¬ëŠ” ë¶„ê¸° íë¦„(Branch Flow), ì •ì˜â€“ì‚¬ìš© ì²´ì¸(Defâ€“Use Chain), ì˜ˆì™¸ ê²½ë¡œ(Exception Path)ë¥¼ í†µí•©í•œ **ë³µí•© ëª©í‘œ(Composite Testing Goals)** ë¥¼ ê¸°ë°˜ìœ¼ë¡œ  
íš¨ìœ¨ì ì´ê³  ì •ë°€í•œ í…ŒìŠ¤íŠ¸ ìƒì„±ì„ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

---

## 1. ì‹¤í—˜ ì„¤ì •

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ëŒ€ìƒ í”„ë¡œì íŠ¸** | `money-transfer-project-template-python` (Temporal ê³µì‹ ì˜ˆì œ) |
| **ì‹¤í—˜ í™˜ê²½** | Google Colab (Ubuntu 22.04, Python 3.10.12) |
| **í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬** | pytest 7.4.4, coverage.py 7.6.1 |
| **LLM ëª¨ë¸** | GPT-4o-2024-05-13 (temperature = 0) |
| **ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€** | SlipCover(Altmayer Pizzorno & Berger, 2023) ê¸°ì¤€ ë¼ì¸/ë¶„ê¸° ë‹¨ìœ„ |
| **ë³µí•© ëª©í‘œ ê°€ì¤‘ì¹˜** | aâ‚=0.4 (ë¶„ê¸°), aâ‚‚=0.4 (ì •ì˜â€“ì‚¬ìš©), aâ‚ƒ=0.2 (ì˜ˆì™¸) |
| **ë¹„ìš© ê³„ìˆ˜(ì˜ˆì‚° ì œì•½)** | bâ‚=0.2 (ê³ ì •ë¹„), bâ‚‚=0.6 (ë¬¸ë§¥ í¬ê¸°), bâ‚ƒ=0.2 (íƒ€ê¹ƒ ìˆ˜) |
| **ê°œì„  ë¼ìš´ë“œ ìˆ˜** | 3ë¼ìš´ë“œ (ì»¤ë²„ë¦¬ì§€ ìˆ˜ë ´ ê¸°ì¤€ ì¢…ë£Œ) |
| **ì‚°ì¶œë¬¼ ê²½ë¡œ** | `run_artifacts/run1/`, `generated_tests/`, `Pruned_Base_Tests/`, `htmlcov_gen/` |

---

## 2. ì‹¤í—˜ ê³¼ì •

### 2.1 ë‹¨ê³„ë³„ ì ˆì°¨
1. **3-1:** ê¸°ì¤€ì„ (PyTest) ì»¤ë²„ë¦¬ì§€ ì¸¡ì •  
2. **3-2:** ë¯¸ì»¤ë²„ ë¼ì¸Â·ë¶„ê¸°Â·ì˜ˆì™¸ ë¶„ì„ ë° ë³µí•© ëª©í‘œ ë„ì¶œ  
3. **3-3:** ê° ëª©í‘œë¥¼ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ë³€í™˜í•˜ê¸° ìœ„í•œ **LLM í”„ë¡¬í”„íŠ¸ ìƒì„±**  
4. **3-4:** ì´ˆê¸° í…ŒìŠ¤íŠ¸ ìƒì„± ë° ì‹¤í–‰ â†’ ì»¤ë²„ë¦¬ì§€ ì‚°ì¶œ  
5. **3-5:** í”„ë£¨ë‹ëœ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ + ìƒì„± í…ŒìŠ¤íŠ¸ í†µí•© ì‹¤í–‰  
6. **3-6:** ì»¤ë²„ë¦¬ì§€ ì´ìµ ë° ì‹¤íŒ¨ ìœ í˜• ê¸°ë°˜ **ë³´ê°• ëŒ€ìƒ ì„ ë³„**  
7. **3-7:** LLMì„ í†µí•œ ë³´ê°• í…ŒìŠ¤íŠ¸ ìƒì„± ë° ìë™ í‰ê°€  
8. **3-8:** í”„ë£¨ë‹ + ìƒì„±Â·ë³´ê°• í…ŒìŠ¤íŠ¸ í†µí•© ì‹¤í–‰ â†’ ì»¤ë²„ë¦¬ì§€ ê²°í•©  
9. **3-9:** PyTest ê¸°ì¤€ì„  vs ìµœì¢… ì§‘í•© ë¹„êµ ë° í–¥ìƒë¥  ë¶„ì„  

### 2.2 ì‚¬ìš©í•œ ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸

#### (1) ì´ˆê¸° í”„ë¡¬í”„íŠ¸ ìƒì„± (3-3 ë‹¨ê³„)

ë‹¤ìŒì€ `activities.py` ë‚´ `deposit()` í•¨ìˆ˜ì˜ ë¶„ê¸° ë° ì •ì˜-ì‚¬ìš© ì²´ì¸ì„ ê²€ì¦í•˜ê¸° ìœ„í•´  
ìƒì„±ëœ **ë³µí•© ëª©í‘œ ê¸°ë°˜ LLM ì…ë ¥ í”„ë¡¬í”„íŠ¸** ì˜ˆì‹œì´ë‹¤.

```json
{
  "meta": {
    "id": "0004",
    "file": "activities.py",
    "function": "deposit",
    "goal_type": ["branch", "def-use"]
  },
  "messages": [
    {
      "role": "system",
      "content": "ë‹¹ì‹ ì€ ì£¼ì–´ì§„ ëª©í‘œ(ë¶„ê¸°/ì •ì˜-ì‚¬ìš©/ì˜ˆì™¸)ë¥¼ ì‹¤í–‰í•˜ëŠ” PyTest í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸ ìƒì„±ê¸°ì…ë‹ˆë‹¤. ì¶œë ¥ì€ ë°˜ë“œì‹œ ë§ˆí¬ë‹¤ìš´ ì—†ì´ í•˜ë‚˜ì˜ JSON ê°ì²´ë¡œë§Œ êµ¬ì„±ë˜ì–´ì•¼ í•˜ë©°, ì†ŒìŠ¤ ì½”ë“œëŠ” ìˆ˜ì •í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
    },
    {
      "role": "user",
      "content": {
        "goal": {
          "file": "activities.py",
          "function": "deposit",
          "target_lines": [45, 47, 50],
          "conditions": [
            "amount > 0",
            "balance + amount <= limit"
          ],
          "def_use_pairs": [
            ["balance", "balance + amount"],
            ["amount", "record_transaction"]
          ]
        }
      }
    }
  ]
}
```

ì´ í”„ë¡¬í”„íŠ¸ëŠ” í…ŒìŠ¤íŠ¸ ëŒ€ìƒ í•¨ìˆ˜ì™€ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ ë¼ì¸,
í•´ë‹¹ ì¡°ê±´ë¬¸ ë° ì •ì˜â€“ì‚¬ìš© ì²´ì¸ì„ í¬í•¨í•˜ì—¬ ëª¨ë¸ì´ ëª…í™•í•œ ì‹¤í–‰ ë‹¨ìœ„ë¥¼ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡ êµ¬ì¡°í™”ë˜ì—ˆë‹¤.

#### (2) ë³´ê°• í”„ë¡¬í”„íŠ¸ ìƒì„± (3-6 ë‹¨ê³„)

ë³´ê°• ë‹¨ê³„ì—ì„œëŠ” ì´ì „ ë¼ìš´ë“œ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë°˜ì˜í•´
ë¯¸ì»¤ë²„ ë¼ì¸ê³¼ ì‹¤íŒ¨ ìœ í˜•(near-miss) ì„ ê¸°ë°˜ìœ¼ë¡œ ì…ë ¥ ì¡°ê±´ ë° ì˜ˆì™¸ íŠ¸ë¦¬ê±°ë¥¼ ìë™ ìˆ˜ì •í•˜ë„ë¡ ìš”ì²­í•˜ì˜€ë‹¤.
```
{
  "meta": {
    "round": 2,
    "base_test": "test_gen_0004_activities_deposit_py_2.py",
    "reason": "near-miss: missed branch on amount <= 0"
  },
  "messages": [
    {
      "role": "system",
      "content": "ì´ì „ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ ë¯¸ë„ë‹¬ ë¶„ê¸°ì™€ ì •ì˜â€“ì‚¬ìš© ì²´ì¸ì„ ëª¨ë‘ ì»¤ë²„í•˜ë„ë¡ í…ŒìŠ¤íŠ¸ë¥¼ ë³´ê°•í•˜ì„¸ìš”. ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ìœ ì§€í•˜ë˜ ì…ë ¥ê°’, ì˜ˆì™¸ ìƒí™©, ê²½ê³„ ì¡°ê±´ì„ ìˆ˜ì •í•´ ìƒˆë¡œìš´ ì»¤ë²„ë¦¬ì§€ë¥¼ í™•ë³´í•´ì•¼ í•©ë‹ˆë‹¤."
    },
    {
      "role": "user",
      "content": {
        "feedback": {
          "missed_lines": [46],
          "missed_conditions": ["amount <= 0"],
          "suggested_actions": [
            "add pytest.raises(ValueError)",
            "include zero or negative deposit case"
          ]
        }
      }
    }
  ]
}
```

ë³´ê°• í”„ë¡¬í”„íŠ¸ëŠ” ëª¨ë¸ì´ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ì˜ ì‹¤íŒ¨ ì›ì¸ì„ íŒŒì•…í•˜ê³ ,
ì¶”ê°€ ì˜ˆì™¸ íë¦„ì´ë‚˜ ê²½ê³„ê°’ ì…ë ¥ì„ ìë™ ì‚½ì…í•˜ë„ë¡ ìœ ë„í•œë‹¤.
ì´ë¡œì¨ ë‹¨ìˆœ ì¬ìƒì„±ì´ ì•„ë‹Œ ì˜ë¯¸ ê¸°ë°˜ ìˆ˜ì •(refinement) ì„ í†µí•´ ì»¤ë²„ë¦¬ì§€ ê³µë°±ì„ ì ì§„ì ìœ¼ë¡œ í•´ì†Œí•˜ì˜€ë‹¤.


---

## 3. ì‹¤í—˜ ê²°ê³¼

### 3.1 ìµœì¢… ì»¤ë²„ë¦¬ì§€ ë¹„êµ

| êµ¬ë¶„               | PyTest | ë³¸ ì—°êµ¬   | í–¥ìƒ     |
| ---------------- | ------ | ------ | ------ |
| **ì‹¤í–‰ëœ í…ŒìŠ¤íŠ¸ ìˆ˜**    | 28     | 31     | +3     |
| **ë¼ì¸ ì»¤ë²„ë¦¬ì§€**      | 65.38% | 78.3%  | +12.9% |
| **ë¶„ê¸° ì»¤ë²„ë¦¬ì§€**      | 60.0%  | 88.71% | +28.7% |
| **ì •ì˜â€“ì‚¬ìš© ì²´ì¸ ë‹¬ì„±ë¥ ** | 53.8%  | 72.1%  | +18.3% |
| **ì˜ˆì™¸ ê²½ë¡œ ì»¤ë²„ë¦¬ì§€**   | 42.9%  | 71.4%  | +28.5% |

* í…ŒìŠ¤íŠ¸ ìˆ˜ëŠ” ì•½ 10% ì¦ê°€í–ˆìœ¼ë‚˜, **ë¼ì¸ ì»¤ë²„ë¦¬ì§€ 1.2ë°°**, **ë¶„ê¸° ì»¤ë²„ë¦¬ì§€ 2.7ë°°**,
  **ì •ì˜â€“ì‚¬ìš©Â·ì˜ˆì™¸ ëª©í‘œ 1.7~2.6ë°°** ì˜ íš¨ìœ¨ í–¥ìƒì„ ë‹¬ì„±í•¨.
* ë¶„ê¸° ë° ì˜ˆì™¸ íë¦„ì—ì„œ ë¯¸ë„ë‹¬ êµ¬ë¬¸ì´ ìƒˆë¡­ê²Œ ì»¤ë²„ë˜ì–´ **í…ŒìŠ¤íŠ¸ êµ¬ì¡°ì  ì™„ì„±ë„**ê°€ ê°œì„ ë¨.

### 3.2 í–¥ìƒ ìš”ì•½ (í…ŒìŠ¤íŠ¸ ìˆ˜ ëŒ€ë¹„)

| í•­ëª©       | ì»¤ë²„ë¦¬ì§€ í–¥ìƒë¥  | í…ŒìŠ¤íŠ¸ ì¦ê°€ìœ¨ | íš¨ìœ¨ë¹„ (í–¥ìƒë¥  Ã· ì¦ê°€ìœ¨) |
| -------- | -------- | ------- | --------------- |
| ë¼ì¸ ì»¤ë²„ë¦¬ì§€  | +12.9%   | +10.7%  | 1.2ë°°            |
| ë¶„ê¸° ì»¤ë²„ë¦¬ì§€  | +28.7%   | +10.7%  | 2.7ë°°            |
| ì •ì˜â€“ì‚¬ìš© ì²´ì¸ | +18.3%   | +10.7%  | 1.7ë°°            |
| ì˜ˆì™¸ ê²½ë¡œ    | +28.5%   | +10.7%  | 2.6ë°°            |

---

## ğŸ“‚ ë¶€ë¡: ì‚°ì¶œë¬¼ êµ¬ì¡°

```
KSC_CaseStudy_Results/
â”œâ”€â”€ run_artifacts/run1/
â”‚   â”œâ”€â”€ coverage_gen.json
â”‚   â”œâ”€â”€ coverage_gen.xml
â”‚   â”œâ”€â”€ goal_achievements.json
â”‚   â””â”€â”€ logs/
â”œâ”€â”€ generated_tests/
â”‚   â”œâ”€â”€ test_gen_0004_activities_deposit_py_1.py
â”‚   â”œâ”€â”€ test_gen_0004_activities_deposit_py_2.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Pruned_Base_Tests/
â”‚   â””â”€â”€ test_run_worker.py
â””â”€â”€ htmlcov_gen/
    â””â”€â”€ index.html   â† ì»¤ë²„ë¦¬ì§€ ì‹œê°í™” ë¦¬í¬íŠ¸
```

---

> ğŸ“˜ **ì—°êµ¬ ë° ì¬í˜„ ì°¸ê³ **
> ì „ì²´ ì‹¤í—˜ ë° ì½”ë“œ ì¬í˜„ì€ [GitHub Repository](https://github.com/hello-suji/KSC-CaseStudy)
> ë˜ëŠ” `run_artifacts/run1/coverage_gen.json` ê²°ê³¼ íŒŒì¼ì„ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```

---
